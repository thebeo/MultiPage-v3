\def\shapver{V100}

\usepackage{tikz} % dessin
\usetikzlibrary{arrows.meta,bending,shapes.geometric,shapes.misc,positioning}
\usepackage{xparse} % for NewDocumentCommand

%%%%
\input{shape/shparse}
%%%%


%%%%%%
% shapes
%%%%%%


%usage \Shapes{shape shape ...shape}[scale]
\NewDocumentCommand\Shapes{m O{1.0}}
{
    \ParseShapes{#1}       
    \shDrawShapes[#2]   
}

\ExplSyntaxOn
%usage \shDrawShapes[scale]
% draw the shapes in \l__ShapeCmd_seq
 \NewDocumentCommand\shDrawShapes{O{1.0}}
{
    \fp_zero_new:N \l__Scale_fp
    \fp_set:Nn \l__Scale_fp {#1}
    
	   %TODO DEBUG seems never reach here
	   % Trace
	    \iow_term:n {shDrawShapes}
           
    % Draw each Shape
    \seq_map_indexed_inline:Nn \l__ShapeCmd_seq  
    {    
		\tl_set:Ne \l__ShapeCmd_tl {##2}
		\tl_set:Ne \l__ShapeMandatoryPar_tl {\seq_item:Nn\l__ShapeMandatoryPar_seq ##1 }
		\tl_set:Ne \l__ShapeOptionPar_tl {\seq_item:Nn\l__ShapeOptionPar_seq ##1 }
		
	
	    % If not exist replace by the unkwow shape
	    \cs_if_exist:cTF{\l__ShapeCmd_tl}
	        {\use:c {\l__ShapeCmd_tl}{\l__ShapeMandatoryPar_tl}[\l__ShapeOptionPar_tl]}
	        {\use:c {dcUKw}}           
        
		    % Trace
		    \iow_term:n {shDrawShapes-end}
		    \tl_show:N \l__ShapeCmd_tl 
		    \tl_show:N \l__ShapeMandatoryPar_tl
		    \tl_show:N \l__ShapeOptionPar_tl
       

   	 }
}
\ExplSyntaxOff

%size
\newdimen\fgsize
\fgsize=10ex

% usage: \RO {color}[inside][scale] - Rond
\def\rdsize{\fgsize}
\newlength{\txtinsidelg}
\newlength{\txtinsideht}

\NewDocumentCommand\RO{mo O{1.0}}{\IfNoValueTF{#2}{\scalebox{#3}{
    \tikz[baseline=-0.5ex]
    {
        \path[draw=#1,line width=1pt]  circle(\rdsize/2);
    }}}{\scalebox{#3}{\settowidth{\txtinsidelg}{#2}\settoheight{\txtinsideht}{#2}\tikz[baseline=-0.5ex]{
        \node [draw=#1,line width=1pt, minimum width=\rdsize/2,text width=\txtinsidelg, text height=\txtinsideht,rounded rectangle,inner sep=\rdsize/2-\txtinsideht/2] {};
        \node at (0,0){{\small{#2}}};
    }}}}

% usage: \TD{color}[inside][scale] - triangle right
\newdimen\tdsize
\tdsize=\fgsize

\NewDocumentCommand\TD{mo O{1.0}}{\IfNoValueTF{#2}{\scalebox{#3}{\tikz[baseline=-0.5ex]{
    \path[draw=#1,line width=1pt] (-\tdsize/2,-\tdsize/2)--(-\tdsize/2,\tdsize/2)--(1.2*\tdsize/2,0)--cycle;
    }}}{\scalebox{#3}{\tikz[baseline=-0.5ex]{
    \path[draw=#1,line width=1pt] (-\tdsize/2,-\tdsize/2)--(-\tdsize/2,\tdsize/2)--(1.2*\tdsize/2,1/4*\tdsize/2)--(1.2*\tdsize/2,-1/4*\tdsize/2)--cycle; \node at (0,0){\small{#2}};
   }}}}


% usage: \TU{color}[inside][scale]  - triangle up
\newdimen\tusize
\tusize=\fgsize %-0.1ex

\NewDocumentCommand\TU{mo O{1.0}}{\IfNoValueTF{#2}{\scalebox{#3}{\tikz[baseline=-0.5ex]{
    \path[draw=#1,line width=1pt] (-\tusize/2,-\tusize/2)--(\tusize/2,-\tusize/2)--(0,\tusize/2)--cycle;
    }}}{\scalebox{#3}{\tikz[baseline=-0.5ex]{
    \path[draw=#1,line width=1pt] (-\tusize/2,-\tusize/2)--(\tusize/2,-\tusize/2)--(0,\tusize/2)--cycle;
    \node at (0,-0.5ex){\small{#2}};
    }}}
}